<?php
/**
 * @file
 * Test interaction between user accounts and webform fields.
 */
class WebformGoalsTestSetUp extends WebformUserTestSetUp {

  /**
   * Implements setUp().
   */
  public function setUp($modules = array(), $permissions = array()) {
    $modules = array_merge($modules, array(
      'webform_goals',
    ));
    parent::setUp($modules);

    // Create user accounts.
    $permissions = array_merge($permissions, array(
      // Create a webform editor to test creating and editing own content.
      'editor' => array(
        'access content',
        'create webform content',
        'edit own webform content',
        'access all webform results',
      ),
      // Create a webform admin that will do all node creation.
      'admin' =>array(
        'access content',
        'administer nodes',
        'create webform content',
        'edit any webform content',
        'access all webform results',
        'edit all webform submissions',
        'delete all webform submissions',
        'administer users',
        'administer user map',
        'alter webform components',
        'configure webform settings',
        'configure webform emails',
      ),
    ));
    foreach ($permissions as $user_key => $role_permissions) {
      $this->users[$user_key] = $this->drupalCreateUser($role_permissions);
    }
    $this->drupalLogin($this->users['admin']);
  }
}

/**
 * Webform user testing class.
 */
class WebformGoalsUITestCase extends WebformGoalsTestSetUp {

  /**
   * Implements getInfo().
   */
  public static function getInfo() {
    return array(
      'name' => t('Webform Goals'),
      'description' => t('Checks goals UI & Display.'),
      'group' => t('Webform User'),
    );
  }

  // Confirm UI elements on webform node create form.
  public function testWebformGoalsUI() {
    // Log in our editor.
    $this->drupalLogin($this->users['editor']);
    $edit = array(
      'title' => t('Test Webform Goals'),
      'body[und][0][value]' => 'test',
    );
    $this->drupalPost('node/add/webform', $edit, t('Save'));

    // TODO: add component.

    // TODO: webform created, make goals.

  }

}

/**
 * Webform user testing class.
 */
class WebformGoalsUnitTestCase extends WebformGoalsTestSetUp {

  /**
   * Implements getInfo().
   */
  public static function getInfo() {
    return array(
      'name' => t('Webform Goals Unit Cases'),
      'description' => t('Individually tests specific functions.'),
      'group' => t('Webform User'),
    );
  }

  /**
   * Unit test helper functions.
   */
  public function testWebformGoalsHelperFunctions() {
    // TODO: test goal progress calculations
    // TODO: test token replacement
  }

}



