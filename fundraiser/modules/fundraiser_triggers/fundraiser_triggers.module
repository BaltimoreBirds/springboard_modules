<?php

/**
 * @file
 * Action and trigger related stuff for the fundraiser module.
 * Why it's own module? Because everyone likes a smaller footprint. If you're using Rules
 * you should have the option to turn off Trigger based responses, and vice versa.
 */

/**
 * Implementation of hook_hook_info().
 */
function fundraiser_triggers_hook_info() {
  return array(
    'fundraiser' => array(
      'fundraiser' => array(
        'sustainer_payment_declined' => array(
          'runs when' => t('A sustainer\'s credit card payment is declined'),
        ),
      ),
    ),
  );
}

/**
 * Implementation of hook_fundraiser().
 */
function fundraiser_triggers_fundraiser($op, $order) {
  $aids = _trigger_get_hook_aids('fundraiser', $op);
  $context = array(
    'hook' => 'fundraiser',
    'op' => $op,
    'order' => $order,
  );
  $dummy = new stdClass();
  actions_do(array_keys($aids), $dummy, $context);
}

/**
 * Implementation of hook_action_info_alter().
 */
function fundraiser_triggers_action_info_alter(&$info) {
  if (isset($info['token_actions_send_email_action']['hooks']['fundraiser'])) {
    array_merge($info['token_actions_send_email_action']['hooks']['fundraiser'], array('sustainer_payment_declined'));
  }
  else {
    $info['token_actions_send_email_action']['hooks']['fundraiser'] = array('sustainer_payment_declined');
  }
}