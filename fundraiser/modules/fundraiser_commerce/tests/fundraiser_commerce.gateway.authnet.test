<?php

/**
 * @file
 * Test suite for Market Source module.
 */

// Include the setup test class.
module_load_include('test', 'fundraiser', 'tests/fundraiser_commerce.gateway'); 

class FundraiserCommerceGatewayAuthnetTest extends FundraiserCommerceGatewayTest {
  protected $privileged_user;

  public static function getInfo() {
    return array(
      'name' => 'Fundraiser Commerce Authorize.net Gateway',
      'description' => 'Confirm the Authorize.net gateway can process a donation.',
      'group' => 'Fundraiser',
    );
  }

  public function setUp($modules = array(), $permissions = array()) {
    $modules = array_merge($modules, array(
      'commerce_authnet'
    ));
    parent::setUp($modules);
    $file = DRUPAL_ROOT . '/' . drupal_get_path('module', 'fundraiser_commerce') . '/tests/authnet.rule';
    $config = file_get_contents($file);
    $this->_importGatewayRule($config);
  }

  function testAuthorize() {
    debug($this->donation_form);
    $edit = array(
      'gateways[credit][id]' => 'authnet_aim|commerce_payment_authnet_aim',
    );
    $this->drupalPost('node/' . $this->donation_form->nid . '/edit', $edit, t('Save'));
    $this->drupalGet('node/' . $this->donation_form->nid);

    $this->_fundraiser_setup_post_donation($this->donation_form->nid);
  }

}
