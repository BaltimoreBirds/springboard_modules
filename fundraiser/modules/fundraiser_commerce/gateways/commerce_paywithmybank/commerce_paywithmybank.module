<?php

/**
 * Implements hook_libraries_info().
 */
function commerce_paywithmybank_libraries_info() {
  $libraries = array();
  $libraries['paywithmybank'] = array(
    'name' => 'PayWithMyBank REST API library',
    'path' => 'libraries',
    'files' => array(
      'php' => array(
        'PayWithMyBank.php',
      ),
    ),
  );

  return $libraries;
}

/**
 * Implements hook_commerce_payment_method_info().
 */
function commerce_paywithmybank_commerce_payment_method_info() {
  $payment_methods = array();
  $payment_methods['commerce_paywithmybank_bank'] = array(
    'base' => 'commerce_paywithmybank_bank',
    'title' => t('PayWithMyBank Bank Account'),
    'short_title' => t('PayWithMyBank'),
    'display_title' => t('Bank Account'),
    'description' => t('Integrates PayWithMyBank for Commerce transactions.'),
    'cardonfile' => array(
      'charge callback' => 'commerce_paywithmybank_bank_cardonfile_charge',
      'update callback' => 'commerce_paywithmybank_bank_cardonfile_update',
      'delete callback' => 'commerce_paywithmybank_bank_cardonfile_delete',
    ),
  );

  return $payment_methods;
}

/**
 * Payment method callback: settings form.
 */
function commerce_paywithmybank_bank_settings_form($settings = NULL) {
  $form = array();
  $form['commerce_paywithmybank_settings_access_id'] = array(
    '#type' => 'textfield',
    '#title' => t('Access ID'),
    '#required' => TRUE,
    '#default_value' => isset($settings['commerce_paywithmybank_settings_access_id']) ? $settings['commerce_paywithmybank_settings_access_id'] : '',
  );

  $form['commerce_paywithmybank_settings_access_key'] = array(
    '#type' => 'textfield',
    '#title' => t('Access Key'),
    '#required' => TRUE,
    '#default_value' => isset($settings['commerce_paywithmybank_settings_access_key']) ? $settings['commerce_paywithmybank_settings_access_key'] : '',
  );

  $form['commerce_paywithmybank_settings_sandbox'] = array(
    '#type' => 'checkbox',
    '#title' => 'Enable sandbox mode',
    '#default_value' => isset($settings['commerce_paywithmybank_settings_sandbox']) ? $settings['commerce_paywithmybank_settings_sandbox'] : FALSE,
  );

  return $form;
}

/**
 * Payment method callback: checkout form.
 */
function commerce_paywithmybank_bank_submit_form($payment_method, $pane_values, $checkout_pane, $order) {
  
}

/**
 * Payment method callback: checkout form validation.
 */
function commerce_paywithmybank_bank_submit_form_validate($payment_method, $pane_form, $pane_values, $order, $form_parents = array()) {
  
}

/**
 * Payment method callback: checkout form submission.
 */
function commerce_paywithmybank_bank_submit_form_submit($payment_method, $pane_form, $pane_values, $order, $charge) {
  
}

function commerce_paywithmybank_bank_cardonfile_charge($payment_method, $card_data, $order, $charge = NULL) {
  
}

function commerce_paywithmybank_bank_cardonfile_update($form, &$form_state, $payment_method, $card_data) {
  
}

function commerce_paywithmybank_bank_cardonfile_delete() {
  
}

/**
 * Gets a new instance of the PayWithMyBank REST API library.
 *
 * @param array @payment_method
 *   The payment method, used to populate library settings.
 *
 * @return \PayWithMyBank\PayWithMyBank
 */
function commerce_paywithmybank_get_api($payment_method) {
  $settings = $payment_method['settings'];

  $accessId = (isset($settings['commerce_paywithmybank_settings_access_id'])) ? $settings['commerce_paywithmybank_settings_access_id'] : NULL;
  $accessKey = (isset($settings['commerce_paywithmybank_settings_access_key'])) ? $settings['commerce_paywithmybank_settings_access_key'] : NULL;
  $sandbox = !empty($settings['commerce_paywithmybank_settings_sandbox']);

  return new \PayWithMyBank\PayWithMyBank($accessId, $accessKey, $sandbox);
}
