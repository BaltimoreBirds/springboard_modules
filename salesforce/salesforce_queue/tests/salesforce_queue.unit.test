<?php
include_once(dirname(__FILE__) . '/salesforce_queue.test');

/**
 * @file
 * Unit tests
 */

/**
 * @file
 * Salesforce queue module unit tests.
 */
class SalesforceQueueUnitTestCase extends SalesforceQueueTestCase {

  public static function getInfo() {
    return array(
      'name' => t('Salesforce queue unit tests'),
      'description' => t('Unit tests for the Salesforce queue module.'),
      'group' => t('Salesforce Queue'),
    );
  }

  /**
   * Implementation of setUp().
   */
  public function setUp() {
    parent::setUp();
  }

  /**
   * Implementation of tearDown().
   */
  public function tearDown() {
    parent::tearDown();
  }

  public function testQueueInsert() {
    $contact = array(
      'FirstName' => 'John',
      'LastName' => 'Doe',
      'Email' => 'john.doe@example.com',
    );

    $qid = salesforce_queue_insert('1', 'user', 'user', 'Contact', 'upsert', $contact, 'Email');

    $this->assertEqual(1, $qid, t('First item id in the queue is 1.'));
  }

  public function testQueueInsertWithDuplicate() {
    $contact = array(
      'FirstName' => 'John',
      'LastName' => 'Doe',
      'Email' => 'john.doe@example.com',
    );

    $qid = salesforce_queue_insert('1', 'user', 'user', 'Contact', 'create', $contact);
    $qid2 = salesforce_queue_insert('1', 'user', 'user', 'Contact', 'create', $contact);
    $this->assertEqual(FALSE, $qid2, t('Duplicate item did not get inserted into queue.'));
  }

  public function testQueueDeletion() {
    $contact = array(
      'FirstName' => 'John',
      'LastName' => 'Doe',
      'Email' => 'john.doe@example.com',
    );

    $qid = salesforce_queue_insert('1', 'user', 'user', 'Contact', 'create', $contact);
    $count = salesforce_queue_dequeue('1', 'user', 'user', 'Contact');
    $this->assertEqual(1, $count, t('One item was removed from queue.'));
  }
}
