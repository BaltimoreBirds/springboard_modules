<?php

/**
 * @file
 * Install hooks for the Salesforce Log module.
 */

/**
 * Implements hook_schema().
 */
function salesforce_log_schema() {
  $schema['salesforce_log_batch'] = array(
    'description' => t('Logs data for the Salesforce Sync.'),
    'fields' => array(
      'bid' => array(
        'description' => 'Unique id of this batch.',
        'type' => 'serial',
        'not null' => TRUE,
      ),
      'start' => array(
        'description' => 'Timestamp of when this batch started.',
        'type' => 'int',
        'not null' => FALSE,
      ),
      'end' => array(
        'description' => 'Timestamp of when this batch finished.',
        'type' => 'int',
        'not null' => FALSE,
      ),
      'count' => array(
        'description' => 'Total amount of items in this batch.',
        'type' => 'int',
        'not null' => FALSE,
      ),
      'successes' => array(
        'description' => 'Count of successfully synced items.',
        'type' => 'int',
        'not null' => FALSE,
        'default' => 0,
      ),
      'failures' => array(
        'description' => 'Count of failed items.',
        'type' => 'int',
        'not null' => FALSE,
        'default' => 0,
      ),
      'module' => array(
        'description' => 'Name of the module that implements the Drupal type.',
        'type' => 'varchar',
        'length' => '255',
        'not null' => FALSE,
      ),
      'delta' => array(
        'description' => 'Name or id of the Drupal sub-type.',
        'type' => 'varchar',
        'length' => '255',
        'not null' => FALSE,
      ),
      'object_type' => array(
        'description' => 'The Salesforce object type.',
        'type' => 'varchar',
        'length' => '255',
        'not null' => FALSE,
      ),
      'operation' => array(
        'description' => 'The action to take in Salesforce.',
        'type' => 'varchar',
        'length' => '10',
        'not null' => FALSE,
      ),
    ),
    'primary key' => array('bid'),
    'indexes' => array(
      'drupal_index' => array(
        'module',
        'delta',
        'object_type',
      ),
    ),
  );

  $schema['salesforce_log_item'] = array(
    'description' => t('Logs data on individual items for the Salesforce Sync.'),
    'fields' => array(
      'lid' => array(
        'description' => 'Unique id of this item.',
        'type' => 'serial',
        'not null' => TRUE,
      ),
      'item_id' => array(
        'description' => 'Queue id of this item.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'bid' => array(
        'description' => 'The id of the batch containing this item.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'drupal_id' => array(
        'description' => 'The id of the Drupal object.',
        'type' => 'varchar',
        'length' => '50',
        'not null' => TRUE,
      ),
      'module' => array(
        'description' => 'Name of the module that implements the Drupal type.',
        'type' => 'varchar',
        'length' => '255',
        'not null' => FALSE,
      ),
      'delta' => array(
        'description' => 'Name or id of the Drupal sub-type.',
        'type' => 'varchar',
        'length' => '255',
        'not null' => FALSE,
      ),
      'object_type' => array(
        'description' => 'The Salesforce object type.',
        'type' => 'varchar',
        'length' => '255',
        'not null' => TRUE,
      ),
      'operation' => array(
        'description' => 'The action to take in Salesforce.',
        'type' => 'varchar',
        'length' => '10',
        'not null' => TRUE,
        'default' => '',
      ),
      'dedupe_field' => array(
        'description' => 'The Salesforce field to dedupe on during UPSERT operations.',
        'type' => 'varchar',
        'length' => '40',
        'not null' => FALSE,
        'default' => NULL,
      ),
      'sobject' => array(
        'description' => 'The Salesforce sObject in json format.',
        'type' => 'text',
        'size' => 'big',
        'not null' => TRUE,
      ),
      'queue' => array(
        'description' => 'The name of the processing queue this item was within.',
        'type' => 'varchar',
        'length' => '40',
        'not null' => TRUE,
        'default' => 'new',
      ),
      'retries' => array(
        'description' => 'Number of times this item has failed attempts to be processed.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 0,
      ),
      'status' => array(
        'description' => 'Flag for success or failure.',
        'type' => 'varchar',
        'length' => '255',
        'not null' => FALSE,
      ),
      'error_code' => array(
        'description' => 'Error ID from Salesforce.',
        'type' => 'varchar',
        'length' => '255',
        'not null' => FALSE,
      ),
      'message' => array(
        'description' => 'Message from Salesforce.',
        'type' => 'text',
        'size' => 'big',
        'not null' => FALSE,
      ),
      'sfid' => array(
        'description' => 'The Salesforce Id.',
        'type' => 'varchar',
        'length' => '50',
        'not null' => FALSE,
      ),
    ),
    'primary key' => array('lid'),
    'indexes' => array(
      'item_id_bid' => array(
        'item_id',
        'bid',
      ),
    ),
  );

  return $schema;
}
    