# Salesforce Suite General Documentation

Provides an overview of the relationship between the modules provided in the
Drupal contributed `salesforce` module and those provided in the salesforce
subset of the `springboard` suite of modules.    See the documentation provided
for each module for specifics about a given module.

Of the modules provided in the Drupal contributed `salesforce` module, the
following modules are **not** used and should not be enabled when using
`springboard`: `salesforce_pull`, `salesforce_push`.


## Connecting to Salesforce

Required modules: `salesforce`

Supporting modules: `salesforce_soap`

This aspect of the Salesforce suite is entirely handled by the contributed
module.  The initial connection to Salesforce is handled by the primary
`salesforce` module provided by the using an OAuth connection.

The `salesforce` module uses a REST interface by default.  REST calls do not
allow batch operations, while SOAP calls will allow up to 200 records to be
operated upon simultaneously.  The `springboard` suite places a priority to
minimize individual calls to Salesforce and therefore all modules that
communicate with Salesforce that are provided in the `springboard` suite require
the `salesforce_soap` module.

### Patch

_Patch is automatically applied when a `springboard` instance is built using
[Springboard Build](https://github.com/JacksonRiver/Springboard-Build)._

**Fix SOAP Identity:**
 * http://drupal.org/files/salesforce-add-identity_0_10.patch

The `salesforce_soap` module has a bug that prevents the ability to use the
UPSERT operation.  Another bug is caused by separate timeouts between the OAuth
connection and the SOAP authentication, where the SOAP authentication will
expire much sooner than the OAuth connection, and currently the
`salesforce_soap` module provides no way to reestablish a SOAP authentication
when that occurs.  The following patch fixes these problems.


## Communicating with Salesforce

Required modules: `salesforce`, `salesforce_soap`, `salesforce_sync`

Supporting modules: `salesforce_queue`, `salesforce_log`

Deprecated modules: `salesforce_pull`, `salesforce_push`

The `springboard` suite provides a `salesforce_sync` module which is the primary
means of communicating with Salesforce and manipulating records prior to the
export to or import from Salesforce.  In addition, it keeps track of all records
it has synced and which Drupal records are matched with which Salesforce
records.

The `salesforce_sync` module will execute its commands at the moment it is
requested.  The `salesforce_queue` module was designed to offload the storing of
sync requests until a given time comes to finally execute the requests, which it
does by passing the requests to `salesforce_sync`.  The `salesforce_sync` module
expects that you will tell it the best way and order to execute the sync
requests -- in that case, it is "dumb" requiring explicit instructions.  The
`salesforce_queue` module, on the other hand, will sort through the requests,
group them into logical batches in a logical order and filter out requests that
have obvious errors.

As a support to `salesforce_queue`, the `salesforce_log` module is a default
means provided to review the history of what has occurred during the processing
of the queue and what is currently in the queue.

The contributed `salesforce` suite has provided the `salesforce_pull` and
`salesforce_push` modules which have been deprecated by the `salesforce_sync`
and `salesforce_queue` modules provided in the `springboard` suite.  The pull
and push modules implemented their own sync and queue systems combined, but as
two separate modules one for importing and one for exporting.  The `springboard`
suite has divided the tasks in a different direction, separating them by syncing
and queuing, leaving both sync and queue systems capable of both importing and
exporting.

**NOTE:** At this time the `springboard` suite has not implemented a way to send
sync requests instantaneously.  Therefore, in order for sync requests to occur
automatically the `salesforce_queue` module will need to be enabled, or a custom
module created.

**NOTE:** At this time, importing content from Salesforce has not been
implemented.


## Mapping Drupal records to Salesforce Records

Required modules: `salesforce`, `salesforce_mapping`, `salesforce_genmap`

Supporting modules: `salesforce_donation`

The `salesforce` contributed suite provides a `salesforce_mapping` module which
focuses on providing the ability to map Drupal entities to Salesforce objects.
The `springboard` suite has provided additional mapping capabilities through the
`salesforce_genmap` module which has a goal to be agnostic about what type of
Drupal "thing" is being mapped.  Specifically, the `salesforce_genmap` module
provides support for mapping webforms and is the base upon which
`salesforce_donation` is built.

The `salesforce_genmap` module also greatly extends the `salesforce_mapping`
module to provide integration with `salesforce_sync` and `salesforce_queue`, as
well as streamline the mapping form to optimize it for the `springboard` suite.

The `salesforce_donation` module is built using the tools provided by
`salesforce_genmap` and focuses on the complexity of mapping donation
information between various Drupal records and Salesforce.

**NOTE:** The `springboard` suite has a goal to ultimately merge
`salesforce_mapping` and `salesforce_genmap` so that there is a common base of
mapping that can be used for any Drupal "thing" that needs to be mapped.  This
merged module would still directly support mapping entities and webforms in the
same manner that `salesforce_genmap` currently supports mapping webforms.


### Patches

_All patches are automatically applied when a `springboard` instance is built
using [Springboard Build](https://github.com/JacksonRiver/Springboard-Build)._

**Add caching to Salesforce information requests:**
 * http://drupal.org/files/1867156-salesforce_cache_objects_0.patch

Information from Salesforce is frequently requested on forms and that
information is currently not stored in order to prevent requests from occurring
again.  The goal is to minimize calls during rapid-succession request
situations.


**Misc bug fixes:**
 * https://raw.github.com/wiki/JacksonRiver/Springboard-Build/patches/salesforce-bug_fixes-v1/0001-code-sniffer-adhearance.patch
 * https://raw.github.com/wiki/JacksonRiver/Springboard-Build/patches/salesforce-bug_fixes-v1/0002-Fix-instances-of-ocassional-PHP-notices.patch
 * https://raw.github.com/wiki/JacksonRiver/Springboard-Build/patches/salesforce-bug_fixes-v1/0003-Fix-bug-where-mapping-name-length-was-not-being-vali.patch
 * https://raw.github.com/wiki/JacksonRiver/Springboard-Build/patches/salesforce-bug_fixes-v1/0004-Fix-issue-if-key-is-set-to-first-row.patch
 * https://raw.github.com/wiki/JacksonRiver/Springboard-Build/patches/salesforce-bug_fixes-v1/0005-Fix-issue-where-key-form-error-would-target-first-ro.patch

Most of these are minor, however, patch 0004 could prevent validation when it
was necessary.


**Fix ajax validation issue:**
 * https://raw.github.com/wiki/JacksonRiver/Springboard-Build/patches/salesforce-fix_ajax_validation-v3/0001-Extract-logic-for-finding-default-form-field-value-i.patch
 * https://raw.github.com/wiki/JacksonRiver/Springboard-Build/patches/salesforce-fix_ajax_validation-v3/0002-Fix-issue-with-form-validation-caused-by-ajax-calls.patch

This is considered a critical issue because the issue prevented the ability to
build tests on the form. The issue was caused by having each ajax request
validate the entire form, which would cause simpletest to abort.


**Salesforce Mapping form enhancements:**
 * https://raw.github.com/wiki/JacksonRiver/Springboard-Build/patches/salesforce-enhancements-v1/0001-Change-key-requirement-from-externalId-to-idLookup.patch
 * https://raw.github.com/wiki/JacksonRiver/Springboard-Build/patches/salesforce-enhancements-v1/0002-Make-mapping-table-easier-to-alter.patch
 * https://raw.github.com/wiki/JacksonRiver/Springboard-Build/patches/salesforce-enhancements-v1/0003-Make-select-options-more-descriptive.patch

These are not strictly considered bugs, however, 0001 is considered required
because the usage of `externalId` is too restrictive, and 0002 allows an easier
ability to modify the form through the use of hook_alters.


**Add simpletests to Salesforce Mapping:**
 * https://raw.github.com/wiki/JacksonRiver/Springboard-Build/patches/salesforce-tests-v3/0001-Add-tests-for-entity-mapping.patch

This is considered critical in order to provide a streamlined development
environment.
