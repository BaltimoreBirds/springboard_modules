<?php
// $Id$

/**
 * @file
 * Fundraiser A/B Test
 *
 * Adds special functionality to the Webform A/B Test module for use with Fundraising
 * forms.
 */

/**
 * Add win condition for total amount collected?
 */


/**
 * Implementation of hook_webform_ab_get_webform_types().
 */
function fundraiser_ab_webform_ab_get_webform_types() {
  return array('fundraiser' => 'Fundraiser');
}


/**
 * Implementation of hook_webform_ab_validate_conversion().
 * Only returns TRUE if the webform type is fundraiser and the donation payment 
 * was successful. This way, failed credit card payments are not counted as
 * conversions
 */
function fundraiser_ab_webform_ab_validate_conversion($webform_types, $test_node, $form_state) {
  dsm($form_state, 'form_state');
  if ($webform_types == 'fundraiser') {
    return TRUE;
  }
}


/**
 * Implementation of webform_ab_valid_webforms_alter().
 * If the $webform_types is NOT fundraiser, remove any fundraiser forms from 
 * the list
 */
function fundraiser_ab_webform_ab_valid_webforms_alter(&$forms, $webform_types) {
  if ($webform_types != 'fundraiser') {
    $result = db_query("SELECT nid FROM {fundraiser_gateway}");
    while ($row = db_fetch_object($result)) {
      unset($forms[$row->nid]);
    }
  }
}