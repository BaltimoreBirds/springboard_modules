<?php
// $Id: sf_node_import.module,v 1.0.0.0 2009/09/17 06:44:28 pcave Exp $

/**
 * @file
 * Imports objects from salesforce with the Salesforce API.
 */


/**
 * Implemenation of hook_menu().
 */
function sf_node_import_menu() {
	$items['node_import'] = array(
		'page callback' => 'sf_node_import_get_objects',
		'access callback' => TRUE,
		'type' => MENU_NORMAL_ITEM,
	);
	
	return $items;
}

function sf_node_import_get_objects() {
	
	$result = db_query("select fieldmap, salesforce, fields from {salesforce_management_field_map} where drupal = 'node_grant'");
	while($data = db_fetch_object($result)) {
		$fields = unserialize($data->fields);
		$sf_object = $data->salesforce;
	}
	
	$fields_to_query = implode(', ', array_keys($fields));
	$sql = 'select '. $fields_to_query . ' from ' . $sf_object . ' where Type = \'Grant\'';
	
	// Retrieve the object from Salesforce.
	$sf = salesforce_management_api_connect();
	if ($sf) {
		$results = $sf->client->query($sql);
		$output = '<pre>';
		$output .= print_r($results, true);
		$output .= '</pre>';
		return $output;
	}
}

