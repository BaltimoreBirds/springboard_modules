<?php

/**
 * Implements hook_perm().
 */
function aclu_perm() {
  return array('form components - no access', 'form components - limited access');
}

/**
 * Implements hook_menu_alter().
 */
function aclu_menu_alter(&$items) {

  // Remove access to the form components UI in the webform tab for donation forms.
  $items['node/%webform_menu/webform']['page callback'] = 'aclu_webform_page';
  $items['node/%webform_menu/webform/components']['access callback'] = 'aclu_component_access';
}

/**
 * Custom page callback for the webform link on donation form pages.
 */
function aclu_webform_page() {
  $args = func_get_args();
  global $user;
  $node = $args[0];
  if (!user_access('form components - no access') || $user->uid == 1) {
    return webform_components_page($node);
  }
  else {
    module_load_include('inc', 'fundraiser', 'fundraiser.admin');
    return drupal_get_form('fundraiser_confirmation_settings_form', $node);
  }
}

/**
 * Custom access function for form component menu item.
 */
function aclu_component_access() {
  $args = func_get_args();
  $node = $args[1];
  global $user;

  if ($user->uid != 1 && !strcmp($node->type, 'donation_form') && user_access('form components - no access', $user)) {
    return FALSE;
  }
  return TRUE;
}
